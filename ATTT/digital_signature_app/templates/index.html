<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng Ch·ªØ K√Ω S·ªë An To√†n</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Favicon Hi·ªán ƒê·∫°i -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîê</text></svg>">
</head>

<body>

    <div class="container">
        <header>
            <h1>H·ªá Th·ªëng Ch·ªØ K√Ω S·ªë</h1>
            <p>Th·ª±c Thi M√£ H√≥a RSA & H√†m BƒÉm SHA-256</p>
        </header>

        <main>

            <!-- Th√¥ng B√°o -->
            {% if message %}
            <div class="message-box {{ message_type }}">
                {{ message }}

                {% if signature_file %}
                <br>
                <a href="{{ url_for('route_tai_chu_ky', filename=signature_file) }}" class="download-link"
                    target="_blank">‚¨áÔ∏è T·∫£i V·ªÅ File Ch·ªØ K√Ω (.sig)</a>
                {% endif %}

                {% if private_key_file %}
                <br><br>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <a href="{{ url_for('route_tai_khoa', filename=private_key_file) }}" class="download-link"
                        style="color: #ef4444; border-color: #ef4444;">
                        ‚¨áÔ∏è T·∫£i Private Key (B√≠ M·∫≠t)
                    </a>
                    <a href="{{ url_for('route_tai_khoa', filename=public_key_file) }}" class="download-link"
                        style="color: #4f46e5; border-color: #4f46e5;">
                        ‚¨áÔ∏è T·∫£i Public Key (C√¥ng Khai)
                    </a>
                </div>
                {% endif %}
                {% endif %}
                
                <!-- Hien thi QR Code -->
                {% if qr_file %}
                <div class="qr-container">
                    <h3>üì± Qu√©t M√£ QR X√°c Th·ª±c</h3>
                    <img src="{{ url_for('route_tai_qr', filename=qr_file) }}" alt="QR Code">
                    <br>
                    <a href="{{ url_for('route_tai_qr', filename=qr_file) }}" class="download-link" style="margin-top: 10px; display: inline-block;">
                        ‚¨áÔ∏è T·∫£i M√£ QR
                    </a>
                </div>
                {% endif %}

                <!-- Hien thi Ket Qua AI Check -->
                {% if ai_result %}
                <div class="ai-result {{ 'success' if ai_result.hop_le else 'warning' }}">
                    {% if ai_result.hop_le %}
                        <span>‚úÖ <b>AI Check PASS:</b> {{ ai_result.ly_do }}</span>
                    {% else %}
                        <span>‚ö†Ô∏è <b>AI Check WARNING:</b> {{ ai_result.ly_do }}</span>
                        {% if ai_result.chi_tiet %}
                        <div style="font-size: 0.8rem; margin-top: 5px; opacity: 0.9;">
                            Ph·∫ßn m·ªÅm: {{ ai_result.chi_tiet.get('Software', 'Unknown') }}
                        </div>
                        {% endif %}
                    {% endif %}
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Card 1: T·∫°o Kh√≥a -->
            <div class="card">
                <h2><span>üîë</span> T·∫°o B·ªô Kh√≥a (Generate Keys)</h2>
                <p style="margin-bottom: 1rem; font-size: 0.9rem; color: #666;">T·∫°o c·∫∑p kh√≥a Public/Private RSA m·ªõi. L∆∞u
                    √Ω: S·∫Ω ghi ƒë√® l√™n kh√≥a c≈© n·∫øu ƒë√£ t·ªìn t·∫°i.</p>
                <form action="/tao_khoa" method="post">
                    <button type="submit" class="btn-secondary">T·∫°o C·∫∑p Kh√≥a M·ªõi</button>
                </form>
            </div>

            <!-- Card 2: K√Ω File -->
            <div class="card">
                <h2><span>‚úçÔ∏è</span> K√Ω VƒÉn B·∫£n (Sign Document)</h2>
                <form action="/ky_file" method="post" enctype="multipart/form-data">
                    <label>Ch·ªçn File C·∫ßn K√Ω:</label>
                    <input type="file" name="file" required>

                    <label>Private Key Ri√™ng (T√πy Ch·ªçn):</label>
                    <input type="file" name="private_key" accept=".pem">
                    <small style="color: #888; font-size: 0.85rem; margin-top: -0.5rem;">
                        ƒê·ªÉ tr·ªëng n·∫øu d√πng kh√≥a chung tr√™n server
                    </small>

                    <!-- Checkbox AI Check -->
                    <div class="checkbox-wrapper">
                        <label class="checkbox-container">
                            <input type="checkbox" name="ai_check" value="true">
                            <span class="checkmark"></span>
                            ü§ñ K√≠ch ho·∫°t AI Check (Ph√°t hi·ªán ·∫£nh gi·∫£ m·∫°o)
                        </label>
                    </div>

                    <button type="submit" class="sign-btn">K√Ω File Ngay</button>
                </form>
            </div>

            <!-- Card 3: Ki·ªÉm Tra File -->
            <div class="card">
                <h2><span>üõ°Ô∏è</span> Ki·ªÉm Tra To√†n V·∫πn (Verify)</h2>
                <form action="/kiem_tra" method="post" enctype="multipart/form-data">
                    <label>File G·ªëc C·∫ßn Ki·ªÉm Tra:</label>
                    <input type="file" name="file" required>

                    <label>File Ch·ªØ K√Ω (.sig):</label>
                    <input type="file" name="signature" required accept=".sig">

                    <button type="submit" class="verify-btn">X√°c Th·ª±c File</button>
                </form>
            </div>

        </main>

        <footer>
            Ph√°t tri·ªÉn b·ªüi Antigravity ‚Ä¢ B·∫£o M·∫≠t & An To√†n Th√¥ng Tin
        </footer>
    </div>

</body>

</html>